<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}My-Spotify-Insights{% endblock %}</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
        body{
            margin: 0px;
            font-size: 18px;
        }

        h1#header-page{
            font-size: 200%;
            text-align: center;
            margin-top: 0px;
            margin-bottom: 15px;
        }



        section#section-navigation{
            background-color: #f2f2f2;
            margin: 0px;
            margin-bottom: 5px;
            height: 50px;

        }

        section#section-navigation > nav.nav-bar > div.title{
            padding: 5px;
            font-size: 230%;
            display: inline;
        }

        section#section-navigation > nav.nav-bar > a.nav-item{
            font-size: 150%;
            padding: 5px;
        }


        section#section-sidebar-left{
            width: 10%;
            margin-right: 90%;
            margin-bottom: 0px;
            /*min-height: 100%; */

            position: absolute;
            top: 90px;
            left: 0px;
        }



        div.sidebar-left-nav-list{
            font-size: 100%;
            overflow: hidden;
        }

        div.sidebar-left-nav-list > a.nav-item{
            color: #B0B0B0;
            display: block;
            text-align: center;
            padding: 2px 2px;
            border-right: 1px solid gray;
            margin-top: 5px;
            margin-bottom: 5px;
        }

        div.sidebar-left-nav-list > a.active{
            color: black;
            background-color: #A9A9A9;
            border-right: 4px solid #FF4500;
        }



        section#section-content{
            width:  75%;
            margin-left: 10%;
            margin-right: 15%;
        }



        footer{
            background-color: #f2f2f2;
            bottom: 0;
            text-align: center;
            font-size: 80%;
            margin-top: 10px;
        }

        a{
            text-decoration: none;
        }


        div.error-description{
            text-align: center;
            font-size: 150%;
        }

        div.error-code{
            font-size: 300%;
            text-align: center;
            color: red;
        }

        .float-right{
            float: right;
        }

        .float-left{
            float: left;
        }

        div.message-alert{
            text-align: center;
            margin: 5px;
            background-color: #FF7F50;

        }

        div.question-list-body{
            margin-left: 1%;
            margin-right: 1%;
        }

        .text-align-center{
            text-align: center;
        }

        .text-align-right{
            text-align: right;
        }


        span.flask-moment{
            display: block;
            background-color: red;
            text-align: center;
        }


        div#description-bot{
            display:none;
        }

        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
        }
        th, td {
            padding: 5px;
            text-align: left;
        }

        .center {
            margin-left: auto;
            margin-right: auto;
        }

        table tr:nth-child(even){
            background-color: #f2f2f2
        }

        table tr:hover {
            background-color: #ddd;
        }

        div.user-info{
            padding: 15px;
            background-color: #f2f2f2
        }

        div.user-info:hover{
            background-color: #ddd;
        }

        .bold{
            font-weight: bold;
        }

        .inline{
            display: inline;
        }

        .text-center{
            text-align: center;
        }

        .database-status{
            background-color: #ddd;
            padding: 5px 20px;
            margin: 20px;
        }

        .database-status-progress-bar{
            background-color: #ddd;
            margin: 20px;
        }

        .bar-rounded{
            border-radius: 15px;
        }

        #database-status-progress-bar {
            background-color: #808080;
        }

        .progress-bar{
            padding: 5px 20px;
        }


    </style>
</head>
<body>
    <div id="wholepage">

    {% from "bootstrap/nav.html" import render_nav_item %}


    {% block nav %}
    <section id="section-navigation">
        <nav class="nav-bar">
            <div class="title">{{render_nav_item('main.index', 'My-Spotify-Insights') }}</div>

        </nav>
    </section>
    {% endblock %}

    <section id="section-sidebar-left">
        {% block sidebar_left %}
        {% include '_sidebar_left.html' %}
        {% endblock %}
    </section>








    <section id="section-content">
        <h1 id="header-page">{% block header %} My Spotify Insights {% endblock %}</h1>

        {% for message in get_flashed_messages() %}
        <div class="message-alert">{{message}}</div>
        {% endfor %}


        {% block content%}
            <section id="histories-charts">
                <script type="text/javascript" src="http://kozea.github.com/pygal.js/javascripts/svg.jquery.js"></script>
                <script type="text/javascript" src="http://kozea.github.com/pygal.js/javascripts/pygal-tooltips.js"></script>

                <section id="bar-chart">
                    {{ histories_bar_chart.render()|safe }}
                </section>

                <section id="pie-chart">
                    {{ histories_pie_chart.render() |safe }}
                </section>
            </section>
        {% endblock %}
    </section>


    {%block footer %}
    <footer class="bar-rounded">
        My-Spotify-Insights
    </footer>
    {% endblock %}

    <script>
    {% block scripts %}
        {{bootstrap.load_css()}}
        {{bootstrap.load_js()}}
        {{moment.include_jquery()}}
        {{moment.include_moment()}}
    {% endblock %}
    </script>


        <script type="text/javascript">
            $(document).ready(function() {

                var csrf_token = "{{csrf_token() }}";
                var active_users_url = "{{url_for('admin.active_users') }}";

                $(document).ajaxError(function(event, request){
                    var message = null;

                    if (request.responseJSON && request.responseJSON.hasOwnProperty('message')){
                        message = request.responseJSON.message;
                    }else if (request.responseText){
                        var IS_JSON = true;
                        try{
                            var data = JSON.parse(request.responseText);
                        }catch(err){
                            IS_JSON = false;
                        }

                        if (IS_JSON && data != undefined && data.hasOwnProperty('message')){
                            message = JSON.parse(request.responseText).message;
                        }else{
                            message = default_error_message;
                        }
                    }else{
                        message = default_error_message;
                    }
                    //output the message to the screen here
                });


                //set some default values
                $.ajaxSetup({
                    beforeSend: function (xhr, settings) {
                        if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                            xhr.setRequestHeader('X-CSRFToken', csrf_token);
                        }
                    }
                });


                //$(document).on('click', '#user-add', add_user)
                $(document).on('click', '#user-add', test_interval)

                function add_user(){

                    $.ajax({
                        type: 'GET',
                        url: active_users_url,
                        success: function(data){
                            //$('#user-more').hide().html(data).fadeIn(100);
                            $('#user-more').hide().html("new data").fadeIn(100);
                        }

                    });

                }

                //call it once when load
                update_database_status();
                setInterval(update_database_status, 30000);


            });


            //outside doucment ready
            function test_interval(){
                alert("interval...");
            }

            //call and update database status
            function update_database_status(){
                $.ajax({
                    type: 'GET',
                    url: "{{url_for('admin.database_status') }}",
                    success: function(data){
                        $('#database_status').hide().html(data.html).fadeIn(500);
                    }
                });

            }


        </script>

    </div>
</body>
</html>